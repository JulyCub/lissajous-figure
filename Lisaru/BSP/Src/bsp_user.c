/**
 ******************************************************************************
 * @file		:bsp_user.c
 * @project	:
 * @brief		:Project user files.
 * @version	:0.1.0
 * @author	:July
 * @date		:2022.06.27
 ******************************************************************************
 *@attention
 *
 * This file is a specific user file for a specific project.
 * Specific functions definitions within the project are located in this file.
 *
 ******************************************************************************
 */
 
#include "bsp_user.h"
#include "stm32f1xx.h"
#include "stdlib.h"
 

/* VARIABLE DECLARATIONS BEGIN */
/* t图像编号 */
uint8_t image = 200;

/* 图像类型 */
uint8_t image_gate = 0;
/* 频率计模式 */
uint8_t Freq_mode = 0;

lisaru lisa = {
	.orifreq		= 0,
	.putfreq		= 0,
	.amp				= 0,
	.pha				= 0,
};

lisaru lisb = {
	.orifreq		= 0,
	.putfreq		= 0,
	.amp				= 0,
	.pha				= 0,
};

uint16_t now_freq1 = 0;
const uint16_t now_pha1 = 0;
uint16_t now_freq2 = 0;
uint16_t now_pha2 = 0;

uint8_t xFR1_DATA[3] = {0xD0,0x00,0x00};
uint8_t xFR2_DATA[2] = {0x00,0x00};

#if _IT_TIMER_
__IO uint16_t SineCodeTimer1 = 0;
__IO uint16_t SineCodeTimer2 = 0;
#if 0
const uint16_t Sine85bit_0[] = {
	2048, 2187, 2325, 2462, 2597, 2728, 2856, 2979, 3097, 3209,
	3314, 3413, 3504, 3586, 3660, 3725, 3781, 3827, 3863, 3889,
	3905, 3910, 3905, 3889, 3863, 3827, 3781, 3725, 3660, 3586,
	3504, 3413, 3314, 3209, 3097, 2979, 2856, 2728, 2597, 2462,
	2325, 2187, 2048, 1909, 1771, 1634, 1499, 1368, 1240, 1117,
	999, 	887, 	782, 	683, 	592, 	510, 	436, 	371, 	315, 	269, 
	233, 	207,	191, 	186, 	191, 	207, 	233, 	269, 	315, 	371, 
	436, 	510, 	592, 	683, 	782, 	887, 	999, 	1117, 1240, 1368, 
	1499, 1634, 1771, 1909, 2048,
};

const uint16_t Sine85bit_45[] = {
	3314, 3413, 3504, 3586, 3660, 3725, 3781, 3827, 3863, 3889,
	3905, 3910, 3905, 3889, 3863, 3827, 3781, 3725, 3660, 3586,
	3504, 3413, 3314, 3209, 3097, 2979, 2856, 2728, 2597, 2462,
	2325, 2187, 2048, 1909, 1771, 1634, 1499, 1368, 1240, 1117,
	999, 	887, 	782, 	683, 	592, 	510, 	436, 	371, 	315, 	269, 
	233, 	207,	191, 	186, 	191, 	207, 	233, 	269, 	315, 	371, 
	436, 	510, 	592, 	683, 	782, 	887, 	999, 	1117, 1240, 1368, 
	1499, 1634, 1771, 1909, 2048,2048, 2187, 2325, 2462, 2597, 
	2728, 2856, 2979, 3097, 3209,
};

const uint16_t Sine85bit_90[] = {
	3905, 3910, 3905, 3889, 3863, 3827, 3781, 3725, 3660, 3586,
	3504, 3413, 3314, 3209, 3097, 2979, 2856, 2728, 2597, 2462,
	2325, 2187, 2048, 1909, 1771, 1634, 1499, 1368, 1240, 1117,
	999, 	887, 	782, 	683, 	592, 	510, 	436, 	371, 	315, 	269, 
	233, 	207,	191, 	186, 	191, 	207, 	233, 	269, 	315, 	371, 
	436, 	510, 	592, 	683, 	782, 	887, 	999, 	1117, 1240, 1368, 
	1499, 1634, 1771, 1909, 2048,2048, 2187, 2325, 2462, 2597, 
	2728, 2856, 2979, 3097, 3209,
	3314, 3413, 3504, 3586, 3660, 3725, 3781, 3827, 3863, 3889,
};
	
const uint16_t Sine85bit_135[] = {
	3504, 3413, 3314, 3209, 3097, 2979, 2856, 2728, 2597, 2462,
	2325, 2187, 2048, 1909, 1771, 1634, 1499, 1368, 1240, 1117,
	999, 	887, 	782, 	683, 	592, 	510, 	436, 	371, 	315, 	269, 
	233, 	207,	191, 	186, 	191, 	207, 	233, 	269, 	315, 	371, 
	436, 	510, 	592, 	683, 	782, 	887, 	999, 	1117, 1240, 1368, 
	1499, 1634, 1771, 1909, 2048,2048, 2187, 2325, 2462, 2597, 
	2728, 2856, 2979, 3097, 3209,
	3314, 3413, 3504, 3586, 3660, 3725, 3781, 3827, 3863, 3889,
	3905, 3910, 3905, 3889, 3863, 3827, 3781, 3725, 3660, 3586,
};	

const uint16_t Sine85bit_180[] = {
	2325, 2187, 2048, 1909, 1771, 1634, 1499, 1368, 1240, 1117,
	999, 	887, 	782, 	683, 	592, 	510, 	436, 	371, 	315, 	269, 
	233, 	207,	191, 	186, 	191, 	207, 	233, 	269, 	315, 	371, 
	436, 	510, 	592, 	683, 	782, 	887, 	999, 	1117, 1240, 1368, 
	1499, 1634, 1771, 1909, 2048,2048, 2187, 2325, 2462, 2597,
	2728, 2856, 2979, 3097, 3209,
	3314, 3413, 3504, 3586, 3660, 3725, 3781, 3827, 3863, 3889,
	3905, 3910, 3905, 3889, 3863, 3827, 3781, 3725, 3660, 3586,
	3504, 3413, 3314, 3209, 3097, 2979, 2856, 2728, 2597, 2462,
};

const  uint16_t Sine128bit_0[] = {
	2048, 2140, 2232, 2323, 2414, 2504, 2593, 2680, 2766, 2850, 2932, 3012, 3090, 3165, 3237, 3306,
	3373, 3436, 3495, 3552, 3604, 3653, 3697, 3738, 3775, 3807, 3835, 3859, 3878, 3893, 3903, 3909,
	3910, 3906, 3898, 3886, 3869, 3847, 3822, 3791, 3757, 3718, 3676, 3629,	3578, 3524, 3466, 3405,
	3340, 3272, 3201, 3127, 3051, 2972, 2891,	2808, 2723, 2636, 2548, 2459, 2369, 2278, 2186, 2094, 
	2002, 1910,	1818, 1727, 1637, 1548, 1460, 1373, 1288, 1205, 1124, 1045, 969, 	895, 	824, 	756, 
	691,	630, 	572, 	518, 	467, 	420, 	378, 	339, 	305, 	274,	249, 	227, 	210, 	198, 	190, 	186, 
	187, 	193, 	203, 	218,	237,	261, 	289,	321, 	358, 	399, 	443, 	492, 	544, 	601, 	660, 	723,
	790, 	859, 	931, 	1006, 1084, 1164, 1246, 1330, 1416, 1503, 1592, 1682, 1773, 1864, 1956,	2048,
};

const uint16_t Sine128bit_45[] = {
	3373, 3436, 3495, 3552, 3604, 3653, 3697, 3738, 3775, 3807, 3835, 3859, 3878, 3893, 3903, 3909,
	3910, 3906, 3898, 3886, 3869, 3847, 3822, 3791, 3757, 3718, 3676, 3629,	3578, 3524, 3466, 3405,
	3340, 3272, 3201, 3127, 3051, 2972, 2891,	2808, 2723, 2636, 2548, 2459, 2369, 2278, 2186, 2094, 
	2002, 1910,	1818, 1727, 1637, 1548, 1460, 1373, 1288, 1205, 1124, 1045, 969, 	895, 	824, 	756, 
	691,	630, 	572, 	518, 	467, 	420, 	378, 	339, 	305, 	274,	249, 	227, 	210, 	198, 	190, 	186, 
	187, 	193, 	203, 	218,	237,	261, 	289,	321, 	358, 	399, 	443, 	492, 	544, 	601, 	660, 	723,
	790, 	859, 	931, 	1006, 1084, 1164, 1246, 1330, 1416, 1503, 1592, 1682, 1773, 1864, 1956,	2048,
	2048, 2140, 2232, 2323, 2414, 2504, 2593, 2680, 2766, 2850, 2932, 3012, 3090, 3165, 3237, 3306,
};

const uint16_t Sine128bit_90[] = {
	3910, 3906, 3898, 3886, 3869, 3847, 3822, 3791, 3757, 3718, 3676, 3629,	3578, 3524, 3466, 3405,
	3340, 3272, 3201, 3127, 3051, 2972, 2891,	2808, 2723, 2636, 2548, 2459, 2369, 2278, 2186, 2094, 
	2002, 1910,	1818, 1727, 1637, 1548, 1460, 1373, 1288, 1205, 1124, 1045, 969, 	895, 	824, 	756, 
	691,	630, 	572, 	518, 	467, 	420, 	378, 	339, 	305, 	274,	249, 	227, 	210, 	198, 	190, 	186, 
	187, 	193, 	203, 	218,	237,	261, 	289,	321, 	358, 	399, 	443, 	492, 	544, 	601, 	660, 	723,
	790, 	859, 	931, 	1006, 1084, 1164, 1246, 1330, 1416, 1503, 1592, 1682, 1773, 1864, 1956,	2048,
	2048, 2140, 2232, 2323, 2414, 2504, 2593, 2680, 2766, 2850, 2932, 3012, 3090, 3165, 3237, 3306,
	3373, 3436, 3495, 3552, 3604, 3653, 3697, 3738, 3775, 3807, 3835, 3859, 3878, 3893, 3903, 3909,
};

const uint16_t Sine128bit_135[] = {
	3340, 3272, 3201, 3127, 3051, 2972, 2891,	2808, 2723, 2636, 2548, 2459, 2369, 2278, 2186, 2094, 
	2002, 1910,	1818, 1727, 1637, 1548, 1460, 1373, 1288, 1205, 1124, 1045, 969, 	895, 	824, 	756, 
	691,	630, 	572, 	518, 	467, 	420, 	378, 	339, 	305, 	274,	249, 	227, 	210, 	198, 	190, 	186, 
	187, 	193, 	203, 	218,	237,	261, 	289,	321, 	358, 	399, 	443, 	492, 	544, 	601, 	660, 	723,
	790, 	859, 	931, 	1006, 1084, 1164, 1246, 1330, 1416, 1503, 1592, 1682, 1773, 1864, 1956,	2048,
	2048, 2140, 2232, 2323, 2414, 2504, 2593, 2680, 2766, 2850, 2932, 3012, 3090, 3165, 3237, 3306,
	3373, 3436, 3495, 3552, 3604, 3653, 3697, 3738, 3775, 3807, 3835, 3859, 3878, 3893, 3903, 3909,
	3910, 3906, 3898, 3886, 3869, 3847, 3822, 3791, 3757, 3718, 3676, 3629,	3578, 3524, 3466, 3405,
};

const uint16_t Sine128bit_180[] = {
	2002, 1910,	1818, 1727, 1637, 1548, 1460, 1373, 1288, 1205, 1124, 1045, 969, 	895, 	824, 	756, 
	691,	630, 	572, 	518, 	467, 	420, 	378, 	339, 	305, 	274,	249, 	227, 	210, 	198, 	190, 	186, 
	187, 	193, 	203, 	218,	237,	261, 	289,	321, 	358, 	399, 	443, 	492, 	544, 	601, 	660, 	723,
	790, 	859, 	931, 	1006, 1084, 1164, 1246, 1330, 1416, 1503, 1592, 1682, 1773, 1864, 1956,	2048,
	2048, 2140, 2232, 2323, 2414, 2504, 2593, 2680, 2766, 2850, 2932, 3012, 3090, 3165, 3237, 3306,
	3373, 3436, 3495, 3552, 3604, 3653, 3697, 3738, 3775, 3807, 3835, 3859, 3878, 3893, 3903, 3909,
	3910, 3906, 3898, 3886, 3869, 3847, 3822, 3791, 3757, 3718, 3676, 3629,	3578, 3524, 3466, 3405,
	3340, 3272, 3201, 3127, 3051, 2972, 2891,	2808, 2723, 2636, 2548, 2459, 2369, 2278, 2186, 2094, 
};

const uint16_t Sine171bit_0[] = {
	2048, 2117, 2185, 2254, 2322, 2390, 2458, 2524, 2591, 2656, 2721, 2784, 2847, 2909, 2969, 3028, 3086, 3142, 3197, 3251, 3302, 
	3352, 3400, 3447, 3491, 3534, 3574, 3613, 3649, 3683, 3715, 3744, 3771, 3796, 3819, 3839, 3856, 3871, 3884, 3894, 3902, 3907, 
	3910, 3910, 3907, 3902, 3894, 3884, 3871, 3856, 3839, 3819, 3796, 3771, 3744, 3715, 3683, 3649, 3613, 3574, 3534, 3491, 3447,
	3400, 3352, 3302, 3251, 3197, 3142, 3086, 3028, 2969, 2909, 2847, 2784, 2721, 2656, 2591, 2524, 2458, 2390, 2322, 2254, 2185,
	2117, 2048, 1979, 1911, 1842, 1774, 1706, 1638, 1572, 1505, 1440, 1375, 1312, 1249, 1187, 1127, 1068, 1010, 954, 	899, 	845, 
	794, 	744, 	696, 	649, 	605, 	562, 	522, 	483, 	447, 	413, 	381, 	352, 	325, 	300, 	277, 	257, 	240, 	225, 	212, 	202, 	194,
	189, 	186, 	186, 	189, 	194, 	202, 	212, 	225, 	240, 	257, 	277, 	300, 	325, 	352, 	381, 	413, 	447, 	483, 	522, 	562, 	605, 
	649, 	696, 	744, 	794, 	845, 	899, 	954, 	1010, 1068, 1127, 1187, 1249, 1312, 1375, 1440, 1505, 1572, 1638, 1706, 1774, 1842, 
	1911, 1979, 2048,	
};

const uint16_t Sine171bit_45[] = {
	3352, 3400, 3447, 3491, 3534, 3574, 3613, 3649, 3683, 3715, 3744, 3771, 3796, 3819, 3839, 3856, 3871, 3884, 3894, 3902, 3907, 
	3910, 3910, 3907, 3902, 3894, 3884, 3871, 3856, 3839, 3819, 3796, 3771, 3744, 3715, 3683, 3649, 3613, 3574, 3534, 3491, 3447,
	3400, 3352, 3302, 3251, 3197, 3142, 3086, 3028, 2969, 2909, 2847, 2784, 2721, 2656, 2591, 2524, 2458, 2390, 2322, 2254, 2185,
	2117, 2048, 1979, 1911, 1842, 1774, 1706, 1638, 1572, 1505, 1440, 1375, 1312, 1249, 1187, 1127, 1068, 1010, 954, 	899, 	845, 
	794, 	744, 	696, 	649, 	605, 	562, 	522, 	483, 	447, 	413, 	381, 	352, 	325, 	300, 	277, 	257, 	240, 	225, 	212, 	202, 	194,
	189, 	186, 	186, 	189, 	194, 	202, 	212, 	225, 	240, 	257, 	277, 	300, 	325, 	352, 	381, 	413, 	447, 	483, 	522, 	562, 	605, 
	649, 	696, 	744, 	794, 	845, 	899, 	954, 	1010, 1068, 1127, 1187, 1249, 1312, 1375, 1440, 1505, 1572, 1638, 1706, 1774, 1842, 
	1911, 1979, 2048,2048, 2117, 2185, 2254, 2322, 2390, 2458, 2524, 2591, 2656, 2721, 2784, 2847, 2909, 2969, 3028, 3086, 3142, 3197, 3251, 3302, 
};
const uint16_t Sine171bit_90[] = {
	3910, 3910, 3907, 3902, 3894, 3884, 3871, 3856, 3839, 3819, 3796, 3771, 3744, 3715, 3683, 3649, 3613, 3574, 3534, 3491, 3447,
	3400, 3352, 3302, 3251, 3197, 3142, 3086, 3028, 2969, 2909, 2847, 2784, 2721, 2656, 2591, 2524, 2458, 2390, 2322, 2254, 2185,
	2117, 2048, 1979, 1911, 1842, 1774, 1706, 1638, 1572, 1505, 1440, 1375, 1312, 1249, 1187, 1127, 1068, 1010, 954, 	899, 	845, 
	794, 	744, 	696, 	649, 	605, 	562, 	522, 	483, 	447, 	413, 	381, 	352, 	325, 	300, 	277, 	257, 	240, 	225, 	212, 	202, 	194,
	189, 	186, 	186, 	189, 	194, 	202, 	212, 	225, 	240, 	257, 	277, 	300, 	325, 	352, 	381, 	413, 	447, 	483, 	522, 	562, 	605, 
	649, 	696, 	744, 	794, 	845, 	899, 	954, 	1010, 1068, 1127, 1187, 1249, 1312, 1375, 1440, 1505, 1572, 1638, 1706, 1774, 1842, 
	1911, 1979, 2048,	2048, 2117, 2185, 2254, 2322, 2390, 2458, 2524, 2591, 2656, 2721, 2784, 2847, 2909, 2969, 3028, 3086, 3142, 3197, 3251, 3302, 
	3352, 3400, 3447, 3491, 3534, 3574, 3613, 3649, 3683, 3715, 3744, 3771, 3796, 3819, 3839, 3856, 3871, 3884, 3894, 3902, 3907, 
};
const uint16_t Sine171bit_135[] = {
	3400, 3352, 3302, 3251, 3197, 3142, 3086, 3028, 2969, 2909, 2847, 2784, 2721, 2656, 2591, 2524, 2458, 2390, 2322, 2254, 2185,
	2117, 2048, 1979, 1911, 1842, 1774, 1706, 1638, 1572, 1505, 1440, 1375, 1312, 1249, 1187, 1127, 1068, 1010, 954, 	899, 	845, 
	794, 	744, 	696, 	649, 	605, 	562, 	522, 	483, 	447, 	413, 	381, 	352, 	325, 	300, 	277, 	257, 	240, 	225, 	212, 	202, 	194,
	189, 	186, 	186, 	189, 	194, 	202, 	212, 	225, 	240, 	257, 	277, 	300, 	325, 	352, 	381, 	413, 	447, 	483, 	522, 	562, 	605, 
	649, 	696, 	744, 	794, 	845, 	899, 	954, 	1010, 1068, 1127, 1187, 1249, 1312, 1375, 1440, 1505, 1572, 1638, 1706, 1774, 1842, 
	1911, 1979, 2048,	2048, 2117, 2185, 2254, 2322, 2390, 2458, 2524, 2591, 2656, 2721, 2784, 2847, 2909, 2969, 3028, 3086, 3142, 3197, 3251, 3302, 
	3352, 3400, 3447, 3491, 3534, 3574, 3613, 3649, 3683, 3715, 3744, 3771, 3796, 3819, 3839, 3856, 3871, 3884, 3894, 3902, 3907, 
	3910, 3910, 3907, 3902, 3894, 3884, 3871, 3856, 3839, 3819, 3796, 3771, 3744, 3715, 3683, 3649, 3613, 3574, 3534, 3491, 3447,
};
const uint16_t Sine171bit_180[] = {
	2117, 2048, 1979, 1911, 1842, 1774, 1706, 1638, 1572, 1505, 1440, 1375, 1312, 1249, 1187, 1127, 1068, 1010, 954, 	899, 	845, 
	794, 	744, 	696, 	649, 	605, 	562, 	522, 	483, 	447, 	413, 	381, 	352, 	325, 	300, 	277, 	257, 	240, 	225, 	212, 	202, 	194,
	189, 	186, 	186, 	189, 	194, 	202, 	212, 	225, 	240, 	257, 	277, 	300, 	325, 	352, 	381, 	413, 	447, 	483, 	522, 	562, 	605, 
	649, 	696, 	744, 	794, 	845, 	899, 	954, 	1010, 1068, 1127, 1187, 1249, 1312, 1375, 1440, 1505, 1572, 1638, 1706, 1774, 1842, 
	1911, 1979, 2048,	2048, 2117, 2185, 2254, 2322, 2390, 2458, 2524, 2591, 2656, 2721, 2784, 2847, 2909, 2969, 3028, 3086, 3142, 3197, 3251, 3302, 
	3352, 3400, 3447, 3491, 3534, 3574, 3613, 3649, 3683, 3715, 3744, 3771, 3796, 3819, 3839, 3856, 3871, 3884, 3894, 3902, 3907, 
	3910, 3910, 3907, 3902, 3894, 3884, 3871, 3856, 3839, 3819, 3796, 3771, 3744, 3715, 3683, 3649, 3613, 3574, 3534, 3491, 3447,
	3400, 3352, 3302, 3251, 3197, 3142, 3086, 3028, 2969, 2909, 2847, 2784, 2721, 2656, 2591, 2524, 2458, 2390, 2322, 2254, 2185,
};
#endif
#if 1
const uint16_t Sine256bit_0[] = {
	2048, 2094, 2140, 2185, 2231, 2277, 2322, 2368, 2413, 2458, 2502, 
	2546, 2591, 2634, 2678, 2721, 2763, 2805, 2847, 2888, 2929, 2969,
	3009, 3048, 3086, 3124, 3161, 3197, 3233, 3268, 3302, 3336, 3369,
	3400, 3432, 3462, 3491, 3520, 3547, 3574, 3600, 3625, 3649, 3672,
	3694, 3715, 3735, 3753, 3771, 3788, 3804, 3819, 3832, 3845, 3856,
	3867, 3876, 3884, 3891, 3897, 3902, 3906, 3908, 3910, 3910, 3909,
	3907, 3904, 3900, 3894, 3888, 3880, 3871, 3862, 3851, 3839, 3826,
	3811, 3796, 3780, 3763, 3744, 3725, 3704, 3683, 3660, 3637, 3613, 
	3587, 3561, 3534, 3506, 3477, 3447, 3416, 3385, 3352, 3319, 3285,
	3251, 3215, 3179, 3142, 3105, 3067, 3028, 2989, 2949, 2909, 2868,
	2826, 2784, 2742, 2699, 2656, 2612, 2569, 2524, 2480, 2435, 2390,
	2345, 2300, 2254, 2208, 2163, 2117, 2071, 2025, 1979, 1933, 1888, 
	1842, 1796, 1751, 1706, 1661, 1616, 1572, 1527, 1484, 1440, 1397, 
	1354, 1312, 1270, 1228, 1187, 1147, 1107, 1068, 1029, 991, 954, 
	917, 881, 845, 811, 777, 744, 711, 680, 649, 619, 590, 562, 535,
	509, 483, 459, 436, 413, 392, 371, 352, 333, 316, 300, 285, 270,
	257, 245, 234, 225, 216, 208, 202, 196, 192, 189, 187, 186, 186,
	188, 190, 194, 199, 205, 212, 220, 229, 240, 251, 264, 277, 292,
	308, 325, 343, 361, 381, 402, 424, 447, 471, 496, 522, 549, 576, 
	605, 634, 664, 696, 727, 760, 794, 828, 863, 899, 935, 972, 1010, 
	1048, 1087, 1127, 1167, 1208, 1249, 1291, 1333, 1375, 1418, 1462,
	1505, 1550, 1594, 1638, 1683, 1728, 1774, 1819, 1865, 1911, 1956,
	2002, 2048,
};
const uint16_t Sine256bit_45[] = {
	3369, 3400, 3432, 3462, 3491, 3520, 3547, 3574, 3600, 3625, 3649,
	3672, 3694, 3715, 3735, 3753, 3771, 3788, 3804, 3819, 3832, 3845,
	3856, 3867, 3876, 3884, 3891, 3897, 3902, 3906, 3908, 3910, 3910,
  3909,	3907, 3904, 3900, 3894, 3888, 3880, 3871, 3862, 3851, 3839,
  3826, 3811, 3796, 3780, 3763, 3744, 3725, 3704, 3683, 3660, 3637,
	3613, 3587, 3561, 3534, 3506, 3477, 3447, 3416, 3385, 3352, 3319, 
	3285, 3251, 3215, 3179, 3142, 3105, 3067, 3028, 2989, 2949, 2909, 
	2868, 2826, 2784, 2742, 2699, 2656, 2612, 2569, 2524, 2480, 2435,
	2390, 2345, 2300, 2254, 2208, 2163, 2117, 2071, 2025, 1979, 1933, 
	1888, 1842, 1796, 1751, 1706, 1661, 1616, 1572, 1527, 1484, 1440, 
	1397, 1354, 1312, 1270, 1228, 1187, 1147, 1107, 1068, 1029, 991, 
	954,  917,  881,  845, 811, 777, 744, 711, 680, 649, 619, 590, 562, 
	535,  509,  483,  459, 436, 413, 392, 371, 352, 333, 316, 300, 285, 
	270,  257,  245,  234, 225, 216, 208, 202, 196, 192, 189, 187, 186, 
	186,  188,  190,  194, 199, 205, 212, 220, 229, 240, 251, 264, 277, 
	292,  308,  325,  343, 361, 381, 402, 424, 447, 471, 496, 522, 549, 
	576,  605,  634,  664, 696, 727, 760, 794, 828, 863, 899, 935, 972, 
	1010, 1048, 1087, 1127, 1167, 1208, 1249, 1291, 1333, 1375, 1418, 
	1462, 1505, 1550, 1594, 1638, 1683, 1728, 1774, 1819, 1865, 1911, 
	1956, 2002, 2048, 2048, 2094, 2140, 2185, 2231, 2277, 2322, 2368,
	2413, 2458, 2502, 2546, 2591, 2634, 2678, 2721, 2763, 2805, 2847, 
	2888, 2929, 2969, 3009, 3048, 3086, 3124, 3161, 3197, 3233, 
	3268, 3302, 3336
};
const uint16_t Sine256bit_90[] = {
	3910, 3909, 3907, 3904, 3900, 3894, 3888, 3880, 3871, 3862, 3851,
	3839, 3826, 3811, 3796, 3780, 3763, 3744, 3725, 3704, 3683, 3660,
	3637, 3613, 3587, 3561, 3534, 3506, 3477, 3447, 3416, 3385, 3352,
	3319, 3285, 3251, 3215, 3179, 3142, 3105, 3067, 3028, 2989, 2949,
	2909, 2868, 2826, 2784, 2742, 2699, 2656, 2612, 2569, 2524, 2480,
	2435, 2390, 2345, 2300, 2254, 2208, 2163, 2117, 2071, 2025, 1979, 
	1933, 1888, 1842, 1796, 1751, 1706, 1661, 1616, 1572, 1527, 1484, 
	1440, 1397, 1354, 1312, 1270, 1228, 1187, 1147, 1107, 1068, 1029,
	991,  954,  917, 	881, 845, 811, 777, 744, 711, 680, 649, 619, 590, 
	562,  535, 	509, 	483, 459, 436, 413, 392, 371, 352, 333, 316, 300,
	285, 	270,	257, 	245, 234, 225, 216, 208, 202, 196, 192, 189, 187, 
	186, 	186,	188, 	190, 194, 199, 205, 212, 220, 229, 240, 251, 264,
	277, 	292,	308, 	325, 343, 361, 381, 402, 424, 447, 471, 496, 522, 
	549, 	576, 	605, 	634, 664, 696, 727, 760, 794, 828, 863, 899, 935, 
  972, 	1010, 1048, 1087, 1127, 1167, 1208, 1249, 1291, 1333, 1375, 
	1418, 1462,	1505, 1550, 1594, 1638, 1683, 1728, 1774, 1819, 1865,
	1911, 1956,	2002, 2048,	2048, 2094, 2140, 2185, 2231, 2277, 2322, 
	2368, 2413, 2458, 2502, 2546, 2591, 2634, 2678, 2721, 2763, 2805,
	2847, 2888, 2929, 2969,	3009, 3048, 3086, 3124, 3161, 3197, 3233, 
	3268, 3302, 3336, 3369,	3400, 3432, 3462, 3491, 3520, 3547, 3574, 
	3600, 3625, 3649, 3672,	3694, 3715, 3735, 3753, 3771, 3788, 3804, 
	3819, 3832, 3845, 3856,	3867, 3876, 3884, 3891, 3897, 3902, 3906, 
	3908, 3910,
};
const uint16_t Sine256bit_135[] = {
	3352, 3319, 3285,
	3251, 3215, 3179, 3142, 3105, 3067, 3028, 2989, 2949, 2909, 2868,
	2826, 2784, 2742, 2699, 2656, 2612, 2569, 2524, 2480, 2435, 2390,
	2345, 2300, 2254, 2208, 2163, 2117, 2071, 2025, 1979, 1933, 1888, 
	1842, 1796, 1751, 1706, 1661, 1616, 1572, 1527, 1484, 1440, 1397, 
	1354, 1312, 1270, 1228, 1187, 1147, 1107, 1068, 1029, 991, 954, 
	917, 881, 845, 811, 777, 744, 711, 680, 649, 619, 590, 562, 535,
	509, 483, 459, 436, 413, 392, 371, 352, 333, 316, 300, 285, 270,
	257, 245, 234, 225, 216, 208, 202, 196, 192, 189, 187, 186, 186,
	188, 190, 194, 199, 205, 212, 220, 229, 240, 251, 264, 277, 292,
	308, 325, 343, 361, 381, 402, 424, 447, 471, 496, 522, 549, 576, 
	605, 634, 664, 696, 727, 760, 794, 828, 863, 899, 935, 972, 1010, 
	1048, 1087, 1127, 1167, 1208, 1249, 1291, 1333, 1375, 1418, 1462,
	1505, 1550, 1594, 1638, 1683, 1728, 1774, 1819, 1865, 1911, 1956,
	2048, 2094, 2140, 2185, 2231, 2277, 2322, 2368, 2413, 2458, 2502, 
	2546, 2591, 2634, 2678, 2721, 2763, 2805, 2847, 2888, 2929, 2969,
	3009, 3048, 3086, 3124, 3161, 3197, 3233, 3268, 3302, 3336, 3369,
	3400, 3432, 3462, 3491, 3520, 3547, 3574, 3600, 3625, 3649, 3672,
	3694, 3715, 3735, 3753, 3771, 3788, 3804, 3819, 3832, 3845, 3856,
	3867, 3876, 3884, 3891, 3897, 3902, 3906, 3908, 3910, 3910, 3909,
	3907, 3904, 3900, 3894, 3888, 3880, 3871, 3862, 3851, 3839, 3826,
	3811, 3796, 3780, 3763, 3744, 3725, 3704, 3683, 3660, 3637, 3613, 
	3587, 3561, 3534, 3506, 3477, 3447, 3416, 3385,
};
const uint16_t Sine256bit_180[] = {
	2025, 1979, 1933, 1888, 1842, 1796, 1751, 1706, 1661, 1616, 1572,
	1527, 1484, 1440, 1397, 1354, 1312, 1270, 1228, 1187, 1147, 1107,
	1068, 1029, 991, 954, 917, 881, 845, 811, 777, 744, 711, 680, 649,
	619, 590, 562, 535,	509, 483, 459, 436, 413, 392, 371, 352, 333, 
	316, 300, 285, 270,	257, 245, 234, 225, 216, 208, 202, 196, 192,
	189, 187, 186, 186,	188, 190, 194, 199, 205, 212, 220, 229, 240, 
	251, 264, 277, 292,	308, 325, 343, 361, 381, 402, 424, 447, 471,
	496, 522, 549, 576, 605, 634, 664, 696, 727, 760, 794, 828, 863,
	899, 935, 972, 1010, 1048, 1087, 1127, 1167, 1208, 1249, 1291, 1333, 
	1375, 1418, 1462,	1505, 1550, 1594, 1638, 1683, 1728, 1774, 1819,
	1865, 1911, 1956,	2002, 2048,	2048, 2094, 2140, 2185, 2231, 2277, 
	2322, 2368, 2413, 2458, 2502, 2546, 2591, 2634, 2678, 2721, 2763,
	2805, 2847, 2888, 2929, 2969,	3009, 3048, 3086, 3124, 3161, 3197, 
	3233, 3268, 3302, 3336, 3369,	3400, 3432, 3462, 3491, 3520, 3547,
	3574, 3600, 3625, 3649, 3672,	3694, 3715, 3735, 3753, 3771, 3788, 
	3804, 3819, 3832, 3845, 3856,	3867, 3876, 3884, 3891, 3897, 3902,
	3906, 3908, 3910, 3910, 3909,	3907, 3904, 3900, 3894, 3888, 3880, 
	3871, 3862, 3851, 3839, 3826,	3811, 3796, 3780, 3763, 3744, 3725,
	3704, 3683, 3660, 3637, 3613, 3587, 3561, 3534, 3506, 3477, 3447, 
	3416, 3385, 3352, 3319, 3285,	3251, 3215, 3179, 3142, 3105, 3067, 
	3028, 2989, 2949, 2909, 2868,	2826, 2784, 2742, 2699, 2656, 2612, 
	2569, 2524, 2480, 2435, 2390,	2345, 2300, 2254, 2208, 2163, 2117,
	2071,
};
#endif
#if 0
const uint16_t Sine250bit_0[] = {
	2048, 2095, 2142, 2189, 2236, 2282, 2329, 2375, 2421, 2467, 2513, 2558, 2603, 2648, 2692, 2736, 2779, 2822, 2865, 2907, 2948, 2989, 3029, 3069, 3108, 3146, 3184, 3221, 3257, 3292, 3327,
	3360, 3393, 3425, 3456, 3487, 3516, 3545, 3572, 3598, 3624, 3649, 3672, 3694, 3716, 3736, 3755, 3774, 3791, 3807, 3822, 3835, 3848, 3859, 3870, 3879, 3887, 3894, 3899, 3904, 3907, 3909, 
	3910, 3909, 3908, 3905, 3901, 3896, 3890, 3883, 3874, 3865, 3854, 3842, 3829, 3814, 3799, 3782, 3765, 3746, 3726, 3705, 3683, 3660, 3636, 3611, 3585, 3558, 3530, 3502, 3472, 3441, 3409, 
	3377, 3344, 3309, 3274, 3239, 3202, 3165, 3127, 3088, 3049, 3009, 2969, 2928, 2886, 2844, 2801, 2758, 2714, 2670, 2626, 2581, 2536, 2490, 2444, 2398, 2352, 2306, 2259, 2212, 2165, 2118, 
	2071, 2025, 1978, 1931, 1884, 1837, 1790, 1744, 1698, 1652, 1606, 1560, 1515, 1470, 1426, 1382, 1338, 1295, 1252, 1210, 1168, 1127, 1087, 1047, 1008, 969, 	931, 	894, 	857, 	822, 	787, 
	752, 	719, 	687, 	655, 	624, 	594, 	566,	538, 	511, 	485, 	460, 	436, 	413, 	391, 	370, 	350,	331, 	314, 	297, 	282, 	267, 	254, 	242, 	231, 	222, 	213, 	206, 	200, 	195, 	191, 	188, 
	187, 	186, 	187, 	189, 	192, 	197, 	202, 	209, 	217, 	226, 	237, 	248, 	261, 	274, 	289, 	305, 	322, 	341, 	360, 	380, 	402, 	424, 	447, 	472, 	498, 	524, 	551, 	580, 	609,	640, 	671,
	703, 	736, 	769, 	804, 	839, 	875, 	912, 	950, 	988, 	1027, 1067, 1107, 1148, 1189, 1231, 1274, 1317, 1360, 1404, 1448, 1493, 1538, 1583, 1629, 1675, 1721, 1767, 1814, 1860, 1907, 1954,
	2001, 2048,
};
const uint16_t Sine250bit_45[] = {
	3360, 3393, 3425, 3456, 3487, 3516, 3545, 3572, 3598, 3624, 3649, 3672, 3694, 3716, 3736, 3755, 3774, 3791, 3807, 3822, 3835, 3848, 3859, 3870, 3879, 3887, 3894, 3899, 3904, 3907, 3909, 
	3910, 3909, 3908, 3905, 3901, 3896, 3890, 3883, 3874, 3865, 3854, 3842, 3829, 3814, 3799, 3782, 3765, 3746, 3726, 3705, 3683, 3660, 3636, 3611, 3585, 3558, 3530, 3502, 3472, 3441, 3409, 
	3377, 3344, 3309, 3274, 3239, 3202, 3165, 3127, 3088, 3049, 3009, 2969, 2928, 2886, 2844, 2801, 2758, 2714, 2670, 2626, 2581, 2536, 2490, 2444, 2398, 2352, 2306, 2259, 2212, 2165, 2118, 
	2071, 2025, 1978, 1931, 1884, 1837, 1790, 1744, 1698, 1652, 1606, 1560, 1515, 1470, 1426, 1382, 1338, 1295, 1252, 1210, 1168, 1127, 1087, 1047, 1008, 969, 	931, 	894, 	857, 	822, 	787, 
	752, 	719, 	687, 	655, 	624, 	594, 	566,	538, 	511, 	485, 	460, 	436, 	413, 	391, 	370, 	350,	331, 	314, 	297, 	282, 	267, 	254, 	242, 	231, 	222, 	213, 	206, 	200, 	195, 	191, 	188, 
	187, 	186, 	187, 	189, 	192, 	197, 	202, 	209, 	217, 	226, 	237, 	248, 	261, 	274, 	289, 	305, 	322, 	341, 	360, 	380, 	402, 	424, 	447, 	472, 	498, 	524, 	551, 	580, 	609,	640, 	671,
	703, 	736, 	769, 	804, 	839, 	875, 	912, 	950, 	988, 	1027, 1067, 1107, 1148, 1189, 1231, 1274, 1317, 1360, 1404, 1448, 1493, 1538, 1583, 1629, 1675, 1721, 1767, 1814, 1860, 1907, 1954,
	2001, 2048,
	2048, 2095, 2142, 2189, 2236, 2282, 2329, 2375, 2421, 2467, 2513, 2558, 2603, 2648, 2692, 2736, 2779, 2822, 2865, 2907, 2948, 2989, 3029, 3069, 3108, 3146, 3184, 3221, 3257, 3292, 3327,
};
const uint16_t Sine250bit_90[] = {
	3910, 3909, 3908, 3905, 3901, 3896, 3890, 3883, 3874, 3865, 3854, 3842, 3829, 3814, 3799, 3782, 3765, 3746, 3726, 3705, 3683, 3660, 3636, 3611, 3585, 3558, 3530, 3502, 3472, 3441, 3409, 
	3377, 3344, 3309, 3274, 3239, 3202, 3165, 3127, 3088, 3049, 3009, 2969, 2928, 2886, 2844, 2801, 2758, 2714, 2670, 2626, 2581, 2536, 2490, 2444, 2398, 2352, 2306, 2259, 2212, 2165, 2118, 
	2071, 2025, 1978, 1931, 1884, 1837, 1790, 1744, 1698, 1652, 1606, 1560, 1515, 1470, 1426, 1382, 1338, 1295, 1252, 1210, 1168, 1127, 1087, 1047, 1008, 969, 	931, 	894, 	857, 	822, 	787, 
	752, 	719, 	687, 	655, 	624, 	594, 	566,	538, 	511, 	485, 	460, 	436, 	413, 	391, 	370, 	350,	331, 	314, 	297, 	282, 	267, 	254, 	242, 	231, 	222, 	213, 	206, 	200, 	195, 	191, 	188, 
	187, 	186, 	187, 	189, 	192, 	197, 	202, 	209, 	217, 	226, 	237, 	248, 	261, 	274, 	289, 	305, 	322, 	341, 	360, 	380, 	402, 	424, 	447, 	472, 	498, 	524, 	551, 	580, 	609,	640, 	671,
	703, 	736, 	769, 	804, 	839, 	875, 	912, 	950, 	988, 	1027, 1067, 1107, 1148, 1189, 1231, 1274, 1317, 1360, 1404, 1448, 1493, 1538, 1583, 1629, 1675, 1721, 1767, 1814, 1860, 1907, 1954,
	2001, 2048,	
	2048, 2095, 2142, 2189, 2236, 2282, 2329, 2375, 2421, 2467, 2513, 2558, 2603, 2648, 2692, 2736, 2779, 2822, 2865, 2907, 2948, 2989, 3029, 3069, 3108, 3146, 3184, 3221, 3257, 3292, 3327,
	3360, 3393, 3425, 3456, 3487, 3516, 3545, 3572, 3598, 3624, 3649, 3672, 3694, 3716, 3736, 3755, 3774, 3791, 3807, 3822, 3835, 3848, 3859, 3870, 3879, 3887, 3894, 3899, 3904, 3907, 3909, 
};
const uint16_t Sine250bit_135[] = {
	3377, 3344, 3309, 3274, 3239, 3202, 3165, 3127, 3088, 3049, 3009, 2969, 2928, 2886, 2844, 2801, 2758, 2714, 2670, 2626, 2581, 2536, 2490, 2444, 2398, 2352, 2306, 2259, 2212, 2165, 2118, 
	2071, 2025, 1978, 1931, 1884, 1837, 1790, 1744, 1698, 1652, 1606, 1560, 1515, 1470, 1426, 1382, 1338, 1295, 1252, 1210, 1168, 1127, 1087, 1047, 1008, 969, 	931, 	894, 	857, 	822, 	787, 
	752, 	719, 	687, 	655, 	624, 	594, 	566,	538, 	511, 	485, 	460, 	436, 	413, 	391, 	370, 	350,	331, 	314, 	297, 	282, 	267, 	254, 	242, 	231, 	222, 	213, 	206, 	200, 	195, 	191, 	188, 
	187, 	186, 	187, 	189, 	192, 	197, 	202, 	209, 	217, 	226, 	237, 	248, 	261, 	274, 	289, 	305, 	322, 	341, 	360, 	380, 	402, 	424, 	447, 	472, 	498, 	524, 	551, 	580, 	609,	640, 	671,
	703, 	736, 	769, 	804, 	839, 	875, 	912, 	950, 	988, 	1027, 1067, 1107, 1148, 1189, 1231, 1274, 1317, 1360, 1404, 1448, 1493, 1538, 1583, 1629, 1675, 1721, 1767, 1814, 1860, 1907, 1954,
	2001, 2048,
	2048, 2095, 2142, 2189, 2236, 2282, 2329, 2375, 2421, 2467, 2513, 2558, 2603, 2648, 2692, 2736, 2779, 2822, 2865, 2907, 2948, 2989, 3029, 3069, 3108, 3146, 3184, 3221, 3257, 3292, 3327,
	3360, 3393, 3425, 3456, 3487, 3516, 3545, 3572, 3598, 3624, 3649, 3672, 3694, 3716, 3736, 3755, 3774, 3791, 3807, 3822, 3835, 3848, 3859, 3870, 3879, 3887, 3894, 3899, 3904, 3907, 3909, 
	3910, 3909, 3908, 3905, 3901, 3896, 3890, 3883, 3874, 3865, 3854, 3842, 3829, 3814, 3799, 3782, 3765, 3746, 3726, 3705, 3683, 3660, 3636, 3611, 3585, 3558, 3530, 3502, 3472, 3441, 3409, 
};
const uint16_t Sine250bit_180[] = {
	2071, 2025, 1978, 1931, 1884, 1837, 1790, 1744, 1698, 1652, 1606, 1560, 1515, 1470, 1426, 1382, 1338, 1295, 1252, 1210, 1168, 1127, 1087, 1047, 1008, 969, 	931, 	894, 	857, 	822, 	787, 
	752, 	719, 	687, 	655, 	624, 	594, 	566,	538, 	511, 	485, 	460, 	436, 	413, 	391, 	370, 	350,	331, 	314, 	297, 	282, 	267, 	254, 	242, 	231, 	222, 	213, 	206, 	200, 	195, 	191, 	188, 
	187, 	186, 	187, 	189, 	192, 	197, 	202, 	209, 	217, 	226, 	237, 	248, 	261, 	274, 	289, 	305, 	322, 	341, 	360, 	380, 	402, 	424, 	447, 	472, 	498, 	524, 	551, 	580, 	609,	640, 	671,
	703, 	736, 	769, 	804, 	839, 	875, 	912, 	950, 	988, 	1027, 1067, 1107, 1148, 1189, 1231, 1274, 1317, 1360, 1404, 1448, 1493, 1538, 1583, 1629, 1675, 1721, 1767, 1814, 1860, 1907, 1954,
	2001, 2048,
	2048, 2095, 2142, 2189, 2236, 2282, 2329, 2375, 2421, 2467, 2513, 2558, 2603, 2648, 2692, 2736, 2779, 2822, 2865, 2907, 2948, 2989, 3029, 3069, 3108, 3146, 3184, 3221, 3257, 3292, 3327,
	3360, 3393, 3425, 3456, 3487, 3516, 3545, 3572, 3598, 3624, 3649, 3672, 3694, 3716, 3736, 3755, 3774, 3791, 3807, 3822, 3835, 3848, 3859, 3870, 3879, 3887, 3894, 3899, 3904, 3907, 3909, 
	3910, 3909, 3908, 3905, 3901, 3896, 3890, 3883, 3874, 3865, 3854, 3842, 3829, 3814, 3799, 3782, 3765, 3746, 3726, 3705, 3683, 3660, 3636, 3611, 3585, 3558, 3530, 3502, 3472, 3441, 3409, 
	3377, 3344, 3309, 3274, 3239, 3202, 3165, 3127, 3088, 3049, 3009, 2969, 2928, 2886, 2844, 2801, 2758, 2714, 2670, 2626, 2581, 2536, 2490, 2444, 2398, 2352, 2306, 2259, 2212, 2165, 2118, 
};
#endif
#endif
/* VARIABLE DECLARATIONS END */
 

/* FUNCTION DEFINITION BEGIN */
#if  		_AD9959_
void bsp_Init(void)
{
	HAL_TIM_Base_Start_IT(&htim4);
	HAL_TIM_Base_Start(&htim2);
	HAL_UART_Receive_IT(&huart2, rx_buffer, USART_RX_LEN);
	HAL_DAC_Start(&hdac, DAC1_CHANNEL_1);
	HAL_DAC_Start(&hdac, DAC1_CHANNEL_2);
	AD9959_Init();
}
#else /* AD9833 */
void bsp_Init(void)
{
	HAL_TIM_Base_Start_IT(&htim4);
	HAL_TIM_Base_Start(&htim2);
	HAL_UART_Receive_IT(&huart2, rx_buffer, USART_RX_LEN);
	HAL_DAC_Start(&hdac, DAC1_CHANNEL_1);
	HAL_DAC_Start(&hdac, DAC1_CHANNEL_2);
	AD9833_MULT_WaveSeting1(1000, 0, SIN_WAVE, 0);
	AD9833_MULT_WaveSeting2(1000, 0, SIN_WAVE, 0);
	AD9833_MULT_AmpSet1(80);
	AD9833_MULT_AmpSet2(80);
	AD9959_Init();
}
#endif

#if _IT_TIMER_
void bsp_TIM_FreqSwitch(void)
{
#if 0
	/* 100Hz *//* 1 : 1 */
	__HAL_TIM_SET_PRESCALER(&htim6, 71);
	__HAL_TIM_SET_PRESCALER(&htim7, 71);
	__HAL_TIM_SET_AUTORELOAD(&htim6, 38);
	__HAL_TIM_SET_AUTORELOAD(&htim7, 38);
#endif
#if 0
	/* 200Hz */ /* 1 : 2 */
	__HAL_TIM_SET_PRESCALER(&htim6, 40);
	__HAL_TIM_SET_PRESCALER(&htim7, 40);
	__HAL_TIM_SET_AUTORELOAD(&htim6, 67);
	__HAL_TIM_SET_AUTORELOAD(&htim7, 33);
#endif
#if 0
		/* 300Hz */ /* 1 : 3 */
	__HAL_TIM_SET_PRESCALER(&htim6, 10);
	__HAL_TIM_SET_PRESCALER(&htim7, 10);
	__HAL_TIM_SET_AUTORELOAD(&htim6, 254);
	__HAL_TIM_SET_AUTORELOAD(&htim7, 84);
#endif
#if 0
		/* 150Hz */ /* 1 : 1.5 */
	__HAL_TIM_SET_PRESCALER(&htim6, 10);
	__HAL_TIM_SET_PRESCALER(&htim7, 10);
	__HAL_TIM_SET_AUTORELOAD(&htim6, 254);
	__HAL_TIM_SET_AUTORELOAD(&htim7, 169);
#endif
}
#endif

/* DAC软件触发 */
void bsp_DAC_TriggerNONE(void)
{
	DAC_ChannelConfTypeDef sConfig = {0};
	hdac.Instance = DAC;
  if (HAL_DAC_Init(&hdac) != HAL_OK)
  {
    Error_Handler();
  }
  sConfig.DAC_Trigger = DAC_TRIGGER_NONE;
  sConfig.DAC_OutputBuffer = DAC_OUTPUTBUFFER_ENABLE;
  if (HAL_DAC_ConfigChannel(&hdac, &sConfig, DAC_CHANNEL_1) != HAL_OK)
  {
    Error_Handler();
  }
  if (HAL_DAC_ConfigChannel(&hdac, &sConfig, DAC_CHANNEL_2) != HAL_OK)
  {
    Error_Handler();
  }
}
/* DAC定时器触发 */
void bsp_DAC_TriggerTim(void)
{
	DAC_ChannelConfTypeDef sConfig = {0};
	hdac.Instance = DAC;
  if (HAL_DAC_Init(&hdac) != HAL_OK)
  {
    Error_Handler();
  }
  sConfig.DAC_Trigger = DAC_TRIGGER_T6_TRGO;
  sConfig.DAC_OutputBuffer = DAC_OUTPUTBUFFER_ENABLE;
  if (HAL_DAC_ConfigChannel(&hdac, &sConfig, DAC_CHANNEL_1) != HAL_OK)
  {
    Error_Handler();
  }
	sConfig.DAC_Trigger = DAC_TRIGGER_T7_TRGO;
  if (HAL_DAC_ConfigChannel(&hdac, &sConfig, DAC_CHANNEL_2) != HAL_OK)
  {
    Error_Handler();
  }
}

void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim)
{
	if(htim == &TIM_IT_HANDLE)
	{
			bsptim.freq = __HAL_TIM_GetCounter(&TIM_IC_HANDLE);
			TIM_IC_ID->CNT = 0;
		
#if 0
			bsp_TIM_FreqSwitch();
#endif
	}
#if _IT_TIMER_
	if(Freq_mode == 0)
	{
		if(htim == &htim6)
		{
			if(SineCodeTimer1 + lisa.pha >= 256){
				HAL_DAC_SetValue(&hdac, DAC1_CHANNEL_1, DAC_ALIGN_12B_R, Sine256bit_0[SineCodeTimer1 + lisa.pha - 256]);
				if(SineCodeTimer1 >= 256){
					SineCodeTimer1 = 0;
				}
			}
			else{
				HAL_DAC_SetValue(&hdac, DAC1_CHANNEL_1, DAC_ALIGN_12B_R, Sine256bit_0[SineCodeTimer1 + lisa.pha]);
			}
			SineCodeTimer1++;
		}
		else if(htim == &htim7)
		{
			if(SineCodeTimer2 + lisb.pha >= 256){
				HAL_DAC_SetValue(&hdac, DAC1_CHANNEL_2, DAC_ALIGN_12B_R, Sine256bit_0[SineCodeTimer2 + lisb.pha - 256]);
				if(SineCodeTimer2 >= 256){
					SineCodeTimer2 = 0;
				}
			}
			else{
				HAL_DAC_SetValue(&hdac, DAC1_CHANNEL_2, DAC_ALIGN_12B_R, Sine256bit_0[SineCodeTimer2 + lisb.pha]);
			}
			SineCodeTimer2++;
		}
	}
	else if(Freq_mode == 1)
	{
		if(htim == &htim3)
		{
#if 1
			IntReset();
			WriteData_AD9959(FR1_ADD,3,xFR1_DATA,1);//写功能寄存器1
			Write_Phase(1, now_pha2);
#endif
		}
	}
#if 0
	else if(Freq_mode == 1)
	{
			if(htim == &htim6)
		{
			if(SineCodeTimer1 + lisa.pha >= 250){
				HAL_DAC_SetValue(&hdac, DAC1_CHANNEL_1, DAC_ALIGN_12B_R, Sine250bit_0[SineCodeTimer1 + lisa.pha - 250]);
				if(SineCodeTimer1 >= 250){
					SineCodeTimer1 = 0;
				}
			}
			else{
				HAL_DAC_SetValue(&hdac, DAC1_CHANNEL_1, DAC_ALIGN_12B_R, Sine250bit_0[SineCodeTimer1 + lisa.pha]);
			}
			SineCodeTimer1++;
		}
		else if(htim == &htim7)
		{
			if(SineCodeTimer2 + lisb.pha >= 250){
				HAL_DAC_SetValue(&hdac, DAC1_CHANNEL_2, DAC_ALIGN_12B_R, Sine250bit_0[SineCodeTimer2 + lisb.pha - 250]);
				if(SineCodeTimer2 >= 250){
					SineCodeTimer2 = 0;
				}
			}
			else{
				HAL_DAC_SetValue(&hdac, DAC1_CHANNEL_2, DAC_ALIGN_12B_R, Sine250bit_0[SineCodeTimer2 + lisb.pha]);
			}
			SineCodeTimer2++;
		}
	}
#endif
#endif
}

void bsp_usartVar_Callback(uint8_t* str)
{
	HAL_TIM_Base_Stop_IT(&htim3);
	HAL_TIM_Base_Stop_IT(&htim6);
	HAL_TIM_Base_Stop_IT(&htim7);
	HAL_DAC_Stop(&hdac, DAC1_CHANNEL_1);
	HAL_DAC_Stop(&hdac, DAC1_CHANNEL_2);
//	HAL_TIM_Base_Stop(&htim6);
//	HAL_TIM_Base_Stop(&htim7);
	switch(*str)
	{
		case 'a':		image = 0;	image_gate = 0; break;		/* 	频率 1:1 相位差 0° 	*/
		case 'b':		image = 1;	image_gate = 0; break;		/* 	频率 1:1 相位差 45° */
		case 'c':		image = 2;	image_gate = 0; break;		/* 	频率 1:1 相位差 90° */
		case 'd':		image = 3;	image_gate = 0; break;		/* 	频率 1:1 相位差 135°*/
		case 'e':		image = 4;	image_gate = 0; break;		/* 	频率 1:1 相位差 180°*/
		
		case 'f':		image = 5;	image_gate = 0; break;		/* 	频率 1:2 相位差 0° 	*/	
		case 'g':		image = 6;	image_gate = 0; break;		/* 	频率 1:2 相位差 45° */
		case 'h':		image = 7;	image_gate = 0; break;		/* 	频率 1:2 相位差 90° */
		case 'i':		image = 8;	image_gate = 0; break;		/* 	频率 1:2 相位差 135°*/
		case 'j':		image = 9;	image_gate = 0; break;		/* 	频率 1:2 相位差 180°*/
		
		case 'k':		image = 10;	image_gate = 0; break;		/* 	频率 1:3 相位差 0° 	*/
		case 'l':		image = 11;	image_gate = 0; break;		/* 	频率 1:3 相位差 45° */
		case 'm':		image = 12;	image_gate = 0; break;		/* 	频率 1:3 相位差 90° */
		case 'n':		image = 13;	image_gate = 0; break;		/* 	频率 1:3 相位差 135°*/
		case 'o':		image = 14;	image_gate = 0; break;		/* 	频率 1:3 相位差 180°*/
		
		case 'p':		image = 15;	image_gate = 0; break;		/* 	频率 2:3 相位差 0° 	*/
		case 'q':		image = 16;	image_gate = 0; break;		/* 	频率 2:3 相位差 45° */
		case 'r':		image = 17;	image_gate = 0; break;		/* 	频率 2:3 相位差 90° */
		case 's':		image = 18;	image_gate = 0; break;		/* 	频率 2:3 相位差 135°*/
		case 't':		image = 19;	image_gate = 0; break;		/* 	频率 2:3 相位差 180°*/
		
		case 'A':		image = 20;	image_gate = 1; break;		/* 0 */
		case 'B':		image = 21;	image_gate = 1; break;		/* 1 */
		case 'C':		image = 22;	image_gate = 1; break;		/* 2 */
		case 'D':		image = 23;	image_gate = 1; break;		/* 3 */
		case 'E':		image = 24;	image_gate = 1; break;		/* 4 */
		
		case 'F':		image = 25;	image_gate = 1; break;		/* 5 */
		case 'G':		image = 26;	image_gate = 1; break;		/* 6 */
		case 'H':		image = 27;	image_gate = 1; break;		/* 7 */
		case 'I':		image = 28;	image_gate = 1; break;		/* 8 */
		case 'J':		image = 29;	image_gate = 1; break;		/* 9 */
		
		case 'K':		image = 30;	image_gate = 1; break;		/* A */
		case 'L':		image = 31;	image_gate = 1; break;		/* B */
		case 'M':		image = 32; image_gate = 1; break;		/* C */
		case 'N':		image = 33; image_gate = 1; break;		/* D */
		case 'O':		Freq_mode = !Freq_mode;			break;
		default :		image = 200;break;
	}
	bsp_SwitchGate();
	if(Freq_mode == 0)
	{
		bsp_DAC_TriggerNONE();
		SineCodeTimer1 = 0;
		SineCodeTimer2 = 0;
		HAL_DAC_Start(&hdac,DAC1_CHANNEL_1);
		HAL_DAC_Start(&hdac,DAC1_CHANNEL_2);
		SineCodeTimer2 = SineCodeTimer1;
	}
	else if(Freq_mode == 1)
	{
		HAL_DAC_Stop(&hdac, DAC1_CHANNEL_1);
		HAL_DAC_Stop(&hdac, DAC1_CHANNEL_2);
		HAL_TIM_Base_Stop_IT(&htim6);
		HAL_TIM_Base_Stop_IT(&htim7);
#if 0
		bsp_DAC_TriggerTim();

		if(image <= 4)
		{
			if(lisb.pha == PHA_0)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_45)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine256bit_45, 256, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_90)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine256bit_90, 256, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_135)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine256bit_135, 256, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_180)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine256bit_180, 256, DAC_ALIGN_12B_R);
			}
		}
		else if(image <= 9)
		{
			if(lisb.pha == PHA_0)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine128bit_0, 128, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_45)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine128bit_45, 128, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_90)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine128bit_90, 128, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_135)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine128bit_135, 128, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_180)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine128bit_180, 128, DAC_ALIGN_12B_R);
			}
		}
		else if(image <= 14)
		{
			if(lisb.pha == PHA_0)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine85bit_0, 85, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_45)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine85bit_45, 85, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_90)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine85bit_90, 85, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_135)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine85bit_135, 85, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_180)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine85bit_180, 85, DAC_ALIGN_12B_R);
			}
		}
		else if(image <= 19)
		{
				if(lisb.pha == PHA_0)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine171bit_0, 171, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_45)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine171bit_45, 171, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_90)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine171bit_90, 171, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_135)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine171bit_135, 171, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_180)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine171bit_180, 171, DAC_ALIGN_12B_R);
			}
		}
		HAL_TIM_Base_Start(&htim6);
		HAL_TIM_Base_Start(&htim7);
#endif
	}
}

/* 继电器切档 */
void bsp_SwitchGate(void)
{
	if(Freq_mode == 1){
		HAL_GPIO_WritePin(Switch1_GPIO_Port, Switch1_Pin, GPIO_PIN_SET);
		HAL_GPIO_WritePin(Switch2_GPIO_Port, Switch2_Pin, GPIO_PIN_SET);
	}
	else if(Freq_mode == 0){
		HAL_GPIO_WritePin(Switch1_GPIO_Port, Switch1_Pin, GPIO_PIN_RESET);
		HAL_GPIO_WritePin(Switch2_GPIO_Port, Switch2_Pin, GPIO_PIN_RESET);
	}
}

#if  		_AD9959_
void bsp_drawthewave(lisaru lis1, lisaru lis2)
{
#if 0
	bsp_SwitchGate();

	Write_frequence(0, lis1.putfreq);
	Write_frequence(1, lis2.putfreq);
	Write_Phase(0, 0);
	Write_Phase(1, lis2.pha);
#endif

	if(Freq_mode == 0)
	{
		if(image <= 4){
			/* 100Hz *//* 1 : 1 */
			__HAL_TIM_SET_PRESCALER(&htim6, 71);
			__HAL_TIM_SET_PRESCALER(&htim7, 71);
			__HAL_TIM_SET_AUTORELOAD(&htim6, 38);
			__HAL_TIM_SET_AUTORELOAD(&htim7, 38);
		}
		else if(image <= 9){
			/* 200Hz */ /* 1 : 2 */
			__HAL_TIM_SET_PRESCALER(&htim6, 40);
			__HAL_TIM_SET_PRESCALER(&htim7, 40);
			__HAL_TIM_SET_AUTORELOAD(&htim6, 67);
			__HAL_TIM_SET_AUTORELOAD(&htim7, 33);
		}
		else if(image <= 14){
				/* 300Hz */ /* 1 : 3 */
			__HAL_TIM_SET_PRESCALER(&htim6, 10);
			__HAL_TIM_SET_PRESCALER(&htim7, 10);
			__HAL_TIM_SET_AUTORELOAD(&htim6, 254);
			__HAL_TIM_SET_AUTORELOAD(&htim7, 84);
		}
		else if(image <= 19){
				/* 150Hz */ /* 1 : 1.5 */
			__HAL_TIM_SET_PRESCALER(&htim6, 10);
			__HAL_TIM_SET_PRESCALER(&htim7, 10);
			__HAL_TIM_SET_AUTORELOAD(&htim6, 254);
			__HAL_TIM_SET_AUTORELOAD(&htim7, 169);
		}
		HAL_TIM_Base_Start_IT(&htim6);
		HAL_TIM_Base_Start_IT(&htim7);
	}
	else if(Freq_mode == 1)
	{
#if  0
			__HAL_TIM_SET_PRESCALER(&htim6, 60 - 1);
			__HAL_TIM_SET_PRESCALER(&htim7, 60 - 1);
			__HAL_TIM_SET_AUTORELOAD(&htim6, 4700/lisa.putfreq - 1);
			__HAL_TIM_SET_AUTORELOAD(&htim7, 4700/lisb.putfreq - 1);
#elif  0
			__HAL_TIM_SET_PRESCALER(&htim6, 10 - 1);
			__HAL_TIM_SET_PRESCALER(&htim7, 10 - 1);
		if(image <= 9){
			__HAL_TIM_SET_AUTORELOAD(&htim6, (28125 / lis1.putfreq) - 1);
			__HAL_TIM_SET_AUTORELOAD(&htim7, (28125 / lis2.putfreq) - 1);
		}
		else if(image <= 14){
			__HAL_TIM_SET_AUTORELOAD(&htim6, (28125 / lis1.putfreq));
			__HAL_TIM_SET_AUTORELOAD(&htim7, (28125 / lis2.putfreq));
		}
		else if(image <= 19){
			__HAL_TIM_SET_AUTORELOAD(&htim6, (28125 / lis1.putfreq) + 1);
			__HAL_TIM_SET_AUTORELOAD(&htim7, (28125 / lis2.putfreq) + 1);
		}
#elif  0
			__HAL_TIM_SET_PRESCALER(&htim6, 59);
			__HAL_TIM_SET_PRESCALER(&htim7, 59);
			__HAL_TIM_SET_AUTORELOAD(&htim6, lisa.putfreq/100);
			__HAL_TIM_SET_AUTORELOAD(&htim7, lisb.putfreq/100);
#elif 0
			Write_frequence(0, lis1.putfreq);
			Write_frequence(1, lis2.putfreq);
			Write_Phase(0, lis1.pha);
			Write_Phase(1, lis2.pha);
#endif
	}
}
#else  /* AD9833 */
void bsp_drawthewave(lisaru lis1, lisaru lis2)
{
	if(Freq_mode == 0)
	{
		if(image <= 4){
			/* 100Hz *//* 1 : 1 */
			__HAL_TIM_SET_PRESCALER(&htim6, 71);
			__HAL_TIM_SET_PRESCALER(&htim7, 71);
			__HAL_TIM_SET_AUTORELOAD(&htim6, 38);
			__HAL_TIM_SET_AUTORELOAD(&htim7, 38);
		}
		else if(image <= 9){
			/* 200Hz */ /* 1 : 2 */
			__HAL_TIM_SET_PRESCALER(&htim6, 40);
			__HAL_TIM_SET_PRESCALER(&htim7, 40);
			__HAL_TIM_SET_AUTORELOAD(&htim6, 67);
			__HAL_TIM_SET_AUTORELOAD(&htim7, 33);
		}
		else if(image <= 14){
				/* 300Hz */ /* 1 : 3 */
			__HAL_TIM_SET_PRESCALER(&htim6, 10);
			__HAL_TIM_SET_PRESCALER(&htim7, 10);
			__HAL_TIM_SET_AUTORELOAD(&htim6, 254);
			__HAL_TIM_SET_AUTORELOAD(&htim7, 84);
		}
		else if(image <= 19){
				/* 150Hz */ /* 1 : 1.5 */
			__HAL_TIM_SET_PRESCALER(&htim6, 10);
			__HAL_TIM_SET_PRESCALER(&htim7, 10);
			__HAL_TIM_SET_AUTORELOAD(&htim6, 254);
			__HAL_TIM_SET_AUTORELOAD(&htim7, 169);
		}
		HAL_TIM_Base_Start_IT(&htim6);
		HAL_TIM_Base_Start_IT(&htim7);
	}
	else if(Freq_mode == 1)
	{
//		AD9833_MULT_WaveSeting1(lis1.putfreq, 0, SIN_WAVE, lis1.pha);
//		AD9833_MULT_WaveSeting2(lis2.putfreq, 0, SIN_WAVE, lis2.pha);
#if 0
		AD9833_MULT_WaveSeting1(1000, 0, SIN_WAVE, 0);
		AD9833_MULT_WaveSeting2(1000, 0, SIN_WAVE, 0);
		AD9833_MULT_AmpSet1(80);
		AD9833_MULT_AmpSet2(80);
#else 
		now_freq1 = lis1.putfreq;
		now_freq2 = lis2.putfreq;
		Write_frequence(0, lis1.putfreq);
		Write_frequence(1, lis2.putfreq);
		if(image <= 4){
			switch(lis2.pha)
			{
				case PHA_0:			Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx_0);		now_pha2 = PHAx_0; 		break;
				case PHA_45:		Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx_45);	now_pha2 = PHAx_45; 	break;
				case PHA_90:		Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx_90);	now_pha2 = PHAx_90; 	break;
				case PHA_135:		Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx_135);	now_pha2 = PHAx_135; 	break;
				case PHA_180:		Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx_180);	now_pha2 = PHAx_180; 	break;
				default:																																								break;
			}
		}
		else if(image <= 9){
			switch(lis2.pha)
			{
				case PHA_0:			Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx2_0);		now_pha2 = PHAx_0; 		break;
				case PHA_45:		Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx2_45);		now_pha2 = PHAx_45; 	break;
				case PHA_90:		Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx2_90);		now_pha2 = PHAx_90; 	break;
				case PHA_135:		Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx2_135);	now_pha2 = PHAx_135; 	break;
				case PHA_180:		Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx2_180);	now_pha2 = PHAx_180; 	break;
				default:																																								break;
			}
		}
		else if(image <= 14){
			switch(lis2.pha)
			{
				case PHA_0:			Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx3_0);		now_pha2 = PHAx_0; 		break;
				case PHA_45:		Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx3_45);		now_pha2 = PHAx_45; 	break;
				case PHA_90:		Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx3_90);		now_pha2 = PHAx_90; 	break;
				case PHA_135:		Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx3_135);	now_pha2 = PHAx_135; 	break;
				case PHA_180:		Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx3_180);	now_pha2 = PHAx_180; 	break;
				default:																																								break;
			}
		}
		else if(image <= 19){
			switch(lis2.pha)
			{
				case PHA_0:			Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx4_0);		now_pha2 = PHAx_0; 		break;
				case PHA_45:		Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx4_45);		now_pha2 = PHAx_45; 	break;
				case PHA_90:		Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx4_90);		now_pha2 = PHAx_90; 	break;
				case PHA_135:		Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx4_135);	now_pha2 = PHAx_135; 	break;
				case PHA_180:		Write_Phase(0, PHAx_0);	Write_Phase(1, PHAx4_180);	now_pha2 = PHAx_180; 	break;
				default:																																									break;
			}
		}
		HAL_TIM_Base_Start_IT(&htim3);

#endif
	}
}
#endif
void bsp_imag_select(void)
{
	bsp_usartVar_Conduct();

	if(image_gate == 0){
		lisa.orifreq = bsptim.freq;
		lisb.orifreq = bsptim.freq;
		if(image <= 19)
		{
			if(image <= 4)
			{
				switch(image)
				{
					/* 频率 1:1 相位差 0° */
					case 0:
									lisa.putfreq = lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_0;
									break;
					/* 频率 1:1 相位差 45° */
					case 1:
									lisa.putfreq = lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_45;
									break;
					/* 频率 1:1 相位差 90° */
					case 2:
									lisa.putfreq = lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_90;
									break;
					/* 频率 1:1 相位差 135° */
					case 3:
									lisa.putfreq = lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_135;
									break;
					/* 频率 1:1 相位差 180° */
					case 4:
									lisa.putfreq = lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_180;
									break;
				}
				bsp_drawthewave(lisa, lisb);
			}
			else if(image <= 9)
			{
				switch(image)
				{
					/* 频率 1:2 相位差 0° */
					case 5:
									lisa.putfreq = lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = 2 * lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_0;
									break;
					/* 频率 1:2 相位差 45° */
					case 6:
									lisa.putfreq = lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = 2 * lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_45;
									break;
					/* 频率 1:2 相位差 90° */
					case 7:
									lisa.putfreq = lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = 2 * lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_90;
									break;
					/* 频率 1:2 相位差 135° */
					case 8:
									lisa.putfreq = lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = 2 * lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_135;
									break;
					/* 频率 1:2 相位差 180° */
					case 9:
									lisa.putfreq = lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = 2 * lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_180;
									break;
				}
				bsp_drawthewave(lisa, lisb);
			}
			else if(image <= 14)
			{
				switch(image)
				{
					/* 频率 1:3 相位差 0° */
					case 10:
									lisa.putfreq = lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = 3 * lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_0;
									break;
					/* 频率 1:3 相位差 45° */
					case 11:
									lisa.putfreq = lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = 3 * lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_45;
									break;
					/* 频率 1:3 相位差 90° */
					case 12:
									lisa.putfreq = lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = 3 * lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_90;
									break;
					/* 频率 1:3 相位差 135° */
					case 13:
									lisa.putfreq = lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = 3 * lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_135;
									break;
					/* 频率 1:3 相位差 180° */
					case 14:
									lisa.putfreq = lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = 3 * lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_180;
									break;
				}
				bsp_drawthewave(lisa, lisb);
			}
			else if(image <= 19)
			{
				switch(image)
				{
					/* 频率 2:3 相位差 0° */
					case 15:
									lisa.putfreq = 2 * lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = 3 * lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_0;
									break;
					/* 频率 2:3 相位差 45° */
					case 16:
									lisa.putfreq = 2 * lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = 3 * lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_45;
									break;
					/* 频率 2:3 相位差 90° */
					case 17:
									lisa.putfreq = 2 * lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = 3 * lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_90;
									break;
					/* 频率 2:3 相位差 135° */
					case 18:
									lisa.putfreq = 2 * lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = 3 * lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_135;
									break;
					/* 频率 2:3 相位差 180° */
					case 19:
									lisa.putfreq = 2 * lisa.orifreq;
									lisa.amp = LISARU_AMP;
									lisa.pha = PHA_0;
									lisb.putfreq = 3 * lisb.orifreq;
									lisb.amp = LISARU_AMP;
									lisb.pha = PHA_180;
									break;
				}
				bsp_drawthewave(lisa, lisb);
			}
		}
		else if(image <= 33 || Freq_mode == 1)
		{
#if _IT_TIMER_
//			HAL_TIM_Base_Stop_IT(&htim6);
//			HAL_TIM_Base_Stop_IT(&htim7);
#endif
		}                          
	}
	if(image_gate == 0 && Freq_mode == 1)
	{
#if 0
		if(lisb.pha == PHA_0)
		{
			HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
			HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
		}
		else if(lisb.pha == PHA_45)
		{
			HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
			HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine256bit_45, 256, DAC_ALIGN_12B_R);
		}
		else if(lisb.pha == PHA_90)
		{
			HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
			HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine256bit_90, 256, DAC_ALIGN_12B_R);
		}
		else if(lisb.pha == PHA_135)
		{
			HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
			HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine256bit_135, 256, DAC_ALIGN_12B_R);
		}
		else if(lisb.pha == PHA_180)
		{
			HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
			HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine256bit_180, 256, DAC_ALIGN_12B_R);
		}
#endif
#if 0
		if(image <= 4)
		{
			if(lisb.pha == PHA_0)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_45)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine256bit_45, 256, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_90)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine256bit_90, 256, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_135)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine256bit_135, 256, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_180)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine256bit_135, 256, DAC_ALIGN_12B_R);
			}
		}
		else if(image <= 9)
		{
			if(lisb.pha == PHA_0)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine128bit_0, 128, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_45)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine128bit_45, 128, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_90)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine128bit_90, 128, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_135)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine128bit_135, 128, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_180)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine128bit_180, 128, DAC_ALIGN_12B_R);
			}
		}
		else if(image <= 14)
		{
			if(lisb.pha == PHA_0)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine85bit_0, 85, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_45)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine85bit_45, 85, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_90)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine85bit_90, 85, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_135)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine85bit_135, 85, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_180)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine85bit_180, 85, DAC_ALIGN_12B_R);
			}
		}
		else if(image <= 19)
		{
				if(lisb.pha == PHA_0)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine171bit_0, 171, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_45)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine171bit_45, 171, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_90)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine171bit_90, 171, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_135)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine171bit_135, 171, DAC_ALIGN_12B_R);
			}
			else if(lisb.pha == PHA_180)
			{
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_1, (uint32_t*)Sine256bit_0, 256, DAC_ALIGN_12B_R);
				HAL_DAC_Start_DMA(&hdac, DAC1_CHANNEL_2, (uint32_t*)Sine171bit_180, 171, DAC_ALIGN_12B_R);
			}
		}
#endif		
//		HAL_TIM_Base_Start(&htim6);
//		HAL_TIM_Base_Start(&htim7);
	}
	else if(image_gate == 1){
		HAL_DAC_Start(&hdac, DAC1_CHANNEL_1);
		HAL_DAC_Start(&hdac, DAC1_CHANNEL_2);
		bsp_lisaru_numalp();
	}
}

void bsp_lisaru_numalp(void)
{
#ifndef _IT_TIMER_
	bsp_SwitchGate();
#endif
	switch(image)
	{
		case 20:
			__Lisaru_Draw_Num(0);
			break;
		case 21:
			__Lisaru_Draw_Num(1);
			break;
		case 22:
			__Lisaru_Draw_Num(2);
			break;
		case 23:
			__Lisaru_Draw_Num(3);
			break;
		case 24:
			__Lisaru_Draw_Num(4);
			break;
		case 25:
			__Lisaru_Draw_Num(5);
			break;
		case 26:
			__Lisaru_Draw_Num(6);
			break;
		case 27:
			__Lisaru_Draw_Num(7);
			break;
		case 28:
			__Lisaru_Draw_Num(8);
			break;
		case 29:
			__Lisaru_Draw_Num(9);
			break;
		case 30:
			__Lisaru_Draw_Alp(0);
			break;
		case 31:
			__Lisaru_Draw_Alp(1);
			break;
		case 32:
			__Lisaru_Draw_Alp(2);
			break;
		case 33:
			__Lisaru_Draw_Alp(3);
			break;
	}

}


/* FUNCTION DEFINITION END */

 

